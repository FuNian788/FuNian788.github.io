<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>打怪升级-DeeCamp - Zexian Li</title>
<link rel="shortcut icon" href="https://FuNian788.github.io/favicon.ico">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css">
<link rel="stylesheet" href="https://FuNian788.github.io/media/css/tailwind.css">
<link rel="stylesheet" href="https://FuNian788.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="打怪升级-DeeCamp - Zexian Li - Atom Feed" href="https://FuNian788.github.io/atom.xml">

    

  <meta name="description" content="入选创新工场举办的通过率5%的人工智能夏令营；作为组长和唯一答辩成员，领导队伍协助乐信圣文解决旗下应用Paint By Number线框图提取极度依赖手工和效率低下的问题；提出基于对抗生成网络、区域生长等算法的线框生成策略并实现系统综合集成..." />
  <meta property="og:title" content="打怪升级-DeeCamp - Zexian Li">
  <meta property="og:description" content="入选创新工场举办的通过率5%的人工智能夏令营；作为组长和唯一答辩成员，领导队伍协助乐信圣文解决旗下应用Paint By Number线框图提取极度依赖手工和效率低下的问题；提出基于对抗生成网络、区域生长等算法的线框生成策略并实现系统综合集成..." />
  <meta property="og:type" content="articles">
  <meta property="og:url" content="https://FuNian788.github.io/post/work-deecamp/" />
  <meta property="og:image" content="https://FuNian788.github.io/images/avatar.png">
  <meta property="og:image:height" content="630">
  <meta property="og:image:width" content="1200">
  <meta name="twitter:title" content="打怪升级-DeeCamp - Zexian Li">
  <meta name="twitter:description" content="入选创新工场举办的通过率5%的人工智能夏令营；作为组长和唯一答辩成员，领导队伍协助乐信圣文解决旗下应用Paint By Number线框图提取极度依赖手工和效率低下的问题；提出基于对抗生成网络、区域生长等算法的线框生成策略并实现系统综合集成...">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="canonical" href="https://FuNian788.github.io/post/work-deecamp/">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
 
  
    <link rel="stylesheet" href="https://FuNian788.github.io/media/css/prism-atom-dark.css">
  

  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
  
</head>

<body>
  <div class="antialiased flex flex-col min-h-screen" id="app">
    <a href="https://FuNian788.github.io" class="fixed top-0 left-0 mt-4 bg-black text-white dark:text-gray-700 dark:bg-yellow-50 dark:hover:bg-black dark:hover:text-white inline-flex p-2 pl-8 hover:text-gray-700 hover:bg-yellow-50 font-bold z-10 transition-fast animated fadeInLeft">
      Zexian Li
    </a>
    <div class="max-w-4xl w-full mx-auto">
      <div class="shadow-box bg-white dark:bg-gray-600 rounded-lg pt-32 md:pt-64 px-4 md:px-8 pb-8 animated fadeIn mb-8">
        <h1 class="text-5xl font-semibold leading-normal pb-8 mb-8 border-b-8 border-gray-700">
          打怪升级-DeeCamp
        </h1>
        
        <div class="mb-8 flex flex-wrap">
          <div class="text-gray-400 text-sm mr-4">2020-11-20 · 8 min read</div>
          
        </div>
        <div class="markdown mb-8" v-pre>
          <p><strong>入选创新工场举办的通过率5%的人工智能夏令营；作为组长和唯一答辩成员，领导队伍协助乐信圣文解决旗下应用Paint By Number线框图提取极度依赖手工和效率低下的问题；提出基于对抗生成网络、区域生长等算法的线框生成策略并实现系统综合集成，课题最终获“最具创新奖”，整体排名4/35。</strong></p>
<p><ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#todo">TODO</a></li>
<li><a href="#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D">背景介绍</a></li>
<li><a href="#%E7%97%9B%E7%82%B9">痛点</a></li>
<li><a href="#%E8%AF%BE%E9%A2%98%E5%90%8D%E7%A7%B0">课题名称</a></li>
<li><a href="#%E8%AF%BE%E9%A2%98%E7%9B%AE%E6%A0%87">课题目标</a></li>
<li><a href="#%E5%88%B6%E5%9B%BE%E6%B5%81%E7%A8%8B">制图流程</a></li>
<li><a href="#%E7%AE%97%E6%B3%95%E9%80%89%E5%8F%96">算法选取</a></li>
<li><a href="#%E6%A1%86%E6%9E%B6%E5%8B%BE%E5%8B%92">框架勾勒</a></li>
<li><a href="#%E7%BB%86%E8%8A%82%E5%A1%AB%E5%85%85">细节填充</a></li>
<li><a href="#%E7%BB%BC%E5%90%88%E9%9B%86%E6%88%90">综合集成</a></li>
<li><a href="#%E4%BA%BA%E5%B7%A5ai%E7%AE%97%E6%B3%95%E5%AF%B9%E6%AF%94">人工/AI算法对比</a></li>
<li><a href="#%E8%AF%BE%E9%A2%98%E7%BC%BA%E9%99%B7%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B">课题缺陷/未来展望</a></li>
<li><a href="#%E5%B0%9D%E8%AF%95%E8%BF%87%E7%9A%84%E7%AE%97%E6%B3%95">尝试过的算法</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</p>
<h3 id="todo">TODO</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox" id="task-item-7888070"><label class="task-list-item-label" for="task-item-7888070"> GAN基础知识</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox" id="task-item-3106359"><label class="task-list-item-label" for="task-item-3106359"> PoolNet论文阅读</label></li>
</ul>
<h3 id="背景介绍">背景介绍</h3>
<p>Paint by number（数字填色）是乐信圣文推出的一款通过固定线框和对应数字完成填色的解压类APP，公司需要高效率地生产多类型的线框图以满足旺盛的用户需求。</p>
<h3 id="痛点">痛点</h3>
<p>线框图的制作主要依赖设计师对真实图片手工勾勒线框并上色，生产效率较低。</p>
<h3 id="课题名称">课题名称</h3>
<p>基于图像的边界线框自动生成系统</p>
<h3 id="课题目标">课题目标</h3>
<p>通过AI替代设计师的重复性工作，自动生成相应的边界线框图，减轻设计师线稿制作的工作量。将设计师从重复枯燥的劳动中解放出来，从而创作更多关注内在精神的作品。</p>
<h3 id="制图流程">制图流程</h3>
<p>设计师的制图流程为：图片选取，框架勾勒，细节填充，上色。在此过程中，框架勾勒和细节填充部分是最耗时也是需着重解决的部分。<br>
<img src="https://FuNian788.github.io/post-images/work/deecamp_1.png" alt="设计师流程图" loading="lazy"><br>
在此过程中，框架勾勒和细节填充是最浪费时间，也是我们着重解决的任务。<br>
框架勾勒考验设计师对图片核心内容的把控能力，核心目标为删繁就简、化整为零。<br>
细节填充考验设计师对边缘勾勒的耐心程度，核心目标为细节完整，边缘尽可能闭合。</p>
<h3 id="算法选取">算法选取</h3>
<p>在github主页更新了一系列<a href="https://github.com/FuNian788/DeeCamp32">传统算法代码</a>，包括区域生长、通道压缩、自适应阈值、膨胀腐蚀、Canny算子、闭合区域监测等算法。但此类算法的泛化性普遍较差，对纹理和光影的处理也不尽如人意，故决定使用基于深度学习的方法。<br>
框架勾勒层面，从结果近似于注意力机制热力图角度出发进行模型选取。<br>
细节填充层面，受限于标注的数据集并非像素级别pair(数据集只给出初始图片和设计师成图，设计师对图像细节有较多增减操作)，故舍弃了原理上最匹配的pixelGAN方法(需要像素级配对数据)，从无监督角度出发进行模型选取。</p>
<p>区域生长：<br>
n遍随机种子；基于色块RGB差值的bfs/dfs扩张(如区块小于阈值则舍弃)；剩余空白色块中小者被近邻兼并，大者作为独立色块；每个色块用像素的平均值上色；获取边缘。</p>
<p>通道压缩：<br>
0-255转化为0-15。</p>
<p>自适应阈值：<br>
大津阈值：阈值t下，黑色像素数量占比<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">w_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，黑色像素平均灰度<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>u</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">u_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>；白色像素数量占比<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">w_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，白色像素平均灰度<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>u</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">u_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>；全图的平均灰度<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span>；<br>
类间方差<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mo>=</mo><msub><mi>w</mi><mn>1</mn></msub><mo>∗</mo><mo>(</mo><msub><mi>u</mi><mn>1</mn></msub><mo>−</mo><mi>u</mi><msup><mo>)</mo><mn>2</mn></msup><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><mo>∗</mo><mo>(</mo><msub><mi>u</mi><mn>2</mn></msub><mo>−</mo><mi>u</mi><msup><mo>)</mo><mn>2</mn></msup><mo>=</mo><msub><mi>w</mi><mn>1</mn></msub><mo>∗</mo><msub><mi>w</mi><mn>2</mn></msub><mo>∗</mo><mo>(</mo><msub><mi>u</mi><mn>1</mn></msub><mo>−</mo><msub><mi>u</mi><mn>2</mn></msub><msup><mo>)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">g = w_1 * (u_1 - u)^2 + w_2 * (u_2 - u)^2 = w_1 * w_2 * (u_1 - u_2)^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.61528em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault">u</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.61528em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault">u</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.61528em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.61528em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><br>
遍历所有灰度值，找到g最大时的阈值t即为大津阈值。</p>
<p>膨胀腐蚀：<br>
开操作：先腐蚀再膨胀以消除噪声；<br>
闭操作：先膨胀再腐蚀以填充闭合区域；<br>
梯度：膨胀 - 腐蚀，效果良好。</p>
<p>Canny算子：<br>
高斯平滑图像；计算x、y方向的偏导数以反映边缘强度；边缘的非极大值抑制；双阈值算法检测并连接边缘。</p>
<p>闭合区域检测：<br>
灰度图选取阈值后变成二值图，通过bfs/dfs填满区域并随机填色以检测闭合区域，是区域生长的一部分。</p>
<h3 id="框架勾勒">框架勾勒</h3>
<p><img src="https://FuNian788.github.io/post-images/work/deecamp_2.png" alt="框架勾勒" loading="lazy"><br>
我们使用了2019CVPR提出的PoolNet模型来实现框架的勾勒，该模型较之前的U-Net结构，加入了全局引导模块GGM和特征融合模块FAM以解决高层语义信息在上采样过程中被稀释的问题。为了削弱高倍上采样带来的混叠效应，我们对特征图进行了多尺度池化和拼接操作，实现了特征增强。值得注意的是，我们提取了上采样过程中各阶段的特征图，将其送入残差模块以提升结果图中边缘的锐利程度。在实践中我们惊喜的发现，该算法可保证外轮廓的基本闭合，能较好地满足设计师的需求。<br>
PoolNet是显著性网络，总体呈U-Net/FPN架构，其decoder的三个残差模块对显著性物体的边缘进行预测纠正，同时利用edge dataset，进行显著性检测好边界检测任务的联合训练，显著提升效果。最终输出的边界即为我们所需的框架。</p>
<h3 id="细节填充">细节填充</h3>
<p>在实际的制作流程中，设计师并不拘泥于原图的尺寸和构图，而是会根据图片复杂程度，色块大小，甚至是心情去动态调整框架和细节。很多时候一个轮廓清晰的框架已然足够，但AI能做的不止于此，它还可以为设计师提供很多原图中的逼真细节。<br>
选择无监督的cycleGAN模型实现细节提取任务，将任务转化为在保证细节基础上，由真实图到线框图的风格迁移。<br>
GAN的基本思路如下所示：<br>
<img src="https://FuNian788.github.io/post-images/work/deecamp_3.png" alt="GAN示意图" loading="lazy"><br>
GAN的损失函数可以表达如下：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><munder><mi>min</mi><mo>⁡</mo><mi>G</mi></munder><munder><mi>max</mi><mo>⁡</mo><mi>D</mi></munder><mi mathvariant="normal">ℓ</mi><mo>=</mo><msub><mi mathvariant="double-struck">E</mi><mrow><mi mathvariant="bold">x</mi><mo>∼</mo><msub><mi mathvariant="double-struck">P</mi><mi>r</mi></msub></mrow></msub><mi>log</mi><mo>⁡</mo><mo>[</mo><mi>D</mi><mo>(</mo><mi mathvariant="bold">x</mi><mo>)</mo><mo>]</mo><mo>+</mo><msub><mi mathvariant="double-struck">E</mi><mrow><mi mathvariant="bold">z</mi><mo>∼</mo><msub><mi mathvariant="double-struck">P</mi><mi>z</mi></msub></mrow></msub><mo>[</mo><mi>log</mi><mo>⁡</mo><mo>(</mo><mn>1</mn><mo>−</mo><mi>D</mi><mo>(</mo><mi>G</mi><mo>(</mo><mi mathvariant="bold">z</mi><mo>)</mo><mo>)</mo><mo>)</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">\min _{G} \max _{D} \ell=\mathbb{E}_{\mathbf{x} \sim \mathbb{P}_{r}} \log [D(\mathbf{x})]+\mathbb{E}_{\mathbf{z} \sim \mathbb{P}_{z}}[\log (1-D(G(\mathbf{z})))]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.438771em;vertical-align:-0.7443310000000001em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.66786em;"><span style="top:-2.055669em;margin-left:0em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">G</span></span></span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span><span class="mop">min</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.744331em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999983em;"><span style="top:-2.055669em;margin-left:0em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span></span></span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7443310000000001em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">ℓ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.0001em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">E</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33222299999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight">x</span></span><span class="mrel mtight">∼</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathbb mtight">P</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">x</span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0001em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">E</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33222299999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight">z</span></span><span class="mrel mtight">∼</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathbb mtight">P</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord mathdefault">G</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">z</span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span></span></p>
<p>风格迁移可以类比成数据分布迁移，简单结构的GAN在实现这一过程时，生成器容易迷失方向，较难学习到对应的映射关系(例如将风景图由暖色调转成冷色调，超多生成器均可以实现此任务，但只有保留风景信息的生成器是我们需要的；且传统的结构设计训出来的结果常是使生成器失去学习动力，把任意输入都转成相同且合格的简单输出)，而cycle-GAN则通过使用两套GAN来确保循环一致性(从X域迁移到Y域再迁移回来)，使大海捞针成为可能。<br>
<img src="https://FuNian788.github.io/post-images/work/deecamp_4.png" alt="cycleGAN示意图" loading="lazy"><br>
CycleGAN希望转换前后图片尽可能相似，故其Loss函数在GAN的基本损失函数基础上对图片一致性提出了更高的要求。<br>
<img src="https://FuNian788.github.io/post-images/work/deecamp_5.png" alt="损失函数" loading="lazy"><br>
搭建了包括大量真实图片和线稿图的数据集以供训练(千量级)。最终效果如示例图所示。<br>
<img src="https://FuNian788.github.io/post-images/work/deecamp_6.png" alt="结果示意图" loading="lazy"></p>
<h3 id="综合集成">综合集成</h3>
<p>搭建前端页面以辅助设计师工作。支持图片上传、结果图下载、(PoolNet边框勾勒，CycleGAN细节填充，传统算法提取边缘)、图像矢量化、端点检测等功能。</p>
<h3 id="人工ai算法对比">人工/AI算法对比</h3>
<ol>
<li>传统的作品生成极度依赖设计师的密集手工劳动，经验丰富的设计师也需要4-8个小时才能走完整个流程，而在算法的帮助下，同样的设计师可以在20-40分钟便完成框架和细节的提取，矢量化，上色等任务；</li>
<li>AI算法的引用有效地降低了设计师的人工成本；</li>
<li>和易于维护的算法相比，设计师的流动性较大，不易于长期性的团队建设。</li>
</ol>
<h3 id="课题缺陷未来展望">课题缺陷/未来展望</h3>
<ol>
<li>提高算法质量(边界提取的准确率和闭合率)，生成更加平滑、有层次的线条。</li>
<li>AI算法智能化二次创作，像设计师一样忽略复杂或非重点的内容，对较空的区域填充合理目标，甚至是参考原图语义直接二次创作；</li>
<li>在算法鲁棒性足够强大的基础上，允许用户定制个人感兴趣的图片。</li>
</ol>
<h3 id="尝试过的算法">尝试过的算法</h3>
<p>Sobel算子，Laplace算子，cartoon-GAN(结果模糊)，EdgeBox(断线较多)。</p>

        </div>
        <!-- Share to Twitter, Weibo, Telegram -->
        <div class="flex items-center">
          <div class="mr-4 flex items-center">
            <i class="ri-share-forward-line text-gray-500"></i>
          </div>
          <div class="px-4 cursor-pointer text-blue-500 hover:bg-blue-100 dark:hover:bg-gray-600 inline-flex" @click="shareToTwitter">
            <i class="ri-twitter-line"></i>
          </div>
          <div class="px-4 cursor-pointer text-red-500 hover:bg-red-100 dark:hover:bg-gray-600 inline-flex" @click="shareToWeibo">
            <i class="ri-weibo-line"></i>
          </div>
          <div class="px-4 cursor-pointer text-indigo-500 hover:bg-indigo-100 dark:hover:bg-gray-600 inline-flex" @click="shareToTelegram">
            <i class="ri-telegram-line"></i>
          </div>
        </div>
      </div>

      

      

      <footer class="py-12 text-center px-4 md:px-0" v-pre>
  Bad decisions make good stories.
</footer>
    </div>

    <!-- TOC Container -->
    <div class="fixed right-0 bottom-0 mb-16 mr-4 shadow w-8 h-8 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white dark:bg-gray-500 dark:text-gray-200 hover:shadow-lg transition-all animated fadeInRight" @click="showToc = true">
      <i class="ri-file-list-line"></i>
    </div>

    <div class="fixed right-0 top-0 bottom-0 overflow-y-auto w-64 bg-white dark:bg-gray-800 p-4 border-l border-gray-100 dark:border-gray-600 z-10 transition-fast" :class="{ '-mr-64': !showToc }">
      <div class="flex mb-4 justify-end">
        <div class="w-8 h-8 inline-flex justify-center items-center rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition-fast" @click="showToc = false">
          <i class="ri-close-line text-lg"></i>
        </div>
      </div>
      <div class="post-toc-container">
        <ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#todo">TODO</a></li>
<li><a href="#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D">背景介绍</a></li>
<li><a href="#%E7%97%9B%E7%82%B9">痛点</a></li>
<li><a href="#%E8%AF%BE%E9%A2%98%E5%90%8D%E7%A7%B0">课题名称</a></li>
<li><a href="#%E8%AF%BE%E9%A2%98%E7%9B%AE%E6%A0%87">课题目标</a></li>
<li><a href="#%E5%88%B6%E5%9B%BE%E6%B5%81%E7%A8%8B">制图流程</a></li>
<li><a href="#%E7%AE%97%E6%B3%95%E9%80%89%E5%8F%96">算法选取</a></li>
<li><a href="#%E6%A1%86%E6%9E%B6%E5%8B%BE%E5%8B%92">框架勾勒</a></li>
<li><a href="#%E7%BB%86%E8%8A%82%E5%A1%AB%E5%85%85">细节填充</a></li>
<li><a href="#%E7%BB%BC%E5%90%88%E9%9B%86%E6%88%90">综合集成</a></li>
<li><a href="#%E4%BA%BA%E5%B7%A5ai%E7%AE%97%E6%B3%95%E5%AF%B9%E6%AF%94">人工/AI算法对比</a></li>
<li><a href="#%E8%AF%BE%E9%A2%98%E7%BC%BA%E9%99%B7%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B">课题缺陷/未来展望</a></li>
<li><a href="#%E5%B0%9D%E8%AF%95%E8%BF%87%E7%9A%84%E7%AE%97%E6%B3%95">尝试过的算法</a></li>
</ul>
</li>
</ul>
</li>
</ul>

      </div>
    </div>

    <!-- Back to top -->
    <div class="fixed right-0 bottom-0 mb-4 mr-4 shadow w-8 h-8 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white hover:shadow-lg transition-all dark:bg-gray-500 dark:text-gray-200" @click="backToUp" v-show="scrolled">
      <i class="ri-arrow-up-line"></i>
    </div>
  </div>

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
        It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg">
  </div>
  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
    <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
    </div>
    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->
        <div class="pswp__counter">
        </div>
        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip">
        </div>
      </div>
      <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
      </button>
      <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
      </button>
      <div class="pswp__caption">
        <div class="pswp__caption__center">
        </div>
      </div>
    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://FuNian788.github.io/media/scripts/main.js"></script>
  
  <!-- Code Highlight -->
  
    <script src="https://FuNian788.github.io/media/prism.js"></script>
    <script>
      Prism.highlightAll()
    </script>
  

  <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>
  <script>
    //拿到预览框架，也就是上面的html代码
    var pswpElement = document.querySelectorAll('.pswp')[0];
    //定义图片数组变量
    var imgitems;
    /**
    * 用于显示预览界面
    * @param index 图片数组下标
    */
    function viewImg(index) {
      //其它选项这里不做过多阐述，详情见官网
      var pswpoptions = {
        index: parseInt(index, 10), // 开始幻灯片索引。0是第一张幻灯片。必须是整数，而不是字符串。
        bgOpacity: 0.7, // 背景透明度，0-1
        maxSpreadZoom: 3, // 缩放级别，不要太大
      };
      //初始化并打开PhotoSwipe，pswpElement对应上面预览框架，PhotoSwipeUI_Default为皮肤，imgitems为图片数组，pswpoptions为选项
      var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, imgitems, pswpoptions);
      gallery.init()
    }
    /**
    * 用于添加图片点击事件
    * @param img 图片元素
    * @param index 所属下标（在imgitems中的位置）
    */
    function addImgClick(img, index) {
      img.onclick = function() {
        viewImg(index)
      }
    }
    /**
    * 轮询所有图片，获取src、width、height等数据，加入imgitems，并给图片元素添加事件
    * 最好在onload中执行该方法，本站因放在最底部，所以直接初始化
    * 异步加载图片可在图片元素创建完成后调用此方法
    */
    function initImg() {
      //重置图片数组
      imgitems = [];
      //查找class:markdown 下的所有img元素并遍历
      var imgs = document.querySelectorAll('.markdown img');
      for (var i = 0; i < imgs.length; i++) {
        var img = imgs[i];
        //本站相册初始为loading图片，真实图片放在data-src
        var ds = img.getAttribute("data-src");
        //创建image对象，用于获取图片宽高
        var imgtemp = new Image();
        //判断是否存在data-src
        if (ds != null && ds.length > 0) {
          imgtemp.src = ds
        } else {
          imgtemp.src = img.src
        }
        //判断是否存在缓存
        if (imgtemp.complete) {
          var imgobj = {
            "src": imgtemp.src,
            "w": imgtemp.width,
            "h": imgtemp.height,
          };
          imgitems[i] = imgobj;
          addImgClick(img, i);
        } else {
          console.log('进来了2')
          imgtemp.index = i;
          imgtemp.img = img;
          imgtemp.onload = function() {
            var imgobj = {
              "src": this.src,
              "w": this.width,
              "h": this.height,
            };
            //不要使用push，因为onload前后顺序会不同
            imgitems[this.index] = imgobj
            //添加点击事件
            addImgClick(this.img, this.index);
          }
        }
      }
    }
    //初始化
    initImg();
  </script>
  
  
</body>

</html>